---
title: "Pilot overview"
author: "Valdo Viana & Ashley Lowe-Mckenzie"
date: "2025-11-03"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
source("Documents/GitHub/Trail-Survey_Study/Pilot/3. Analysis/Analysis.R")
```

```{r}
## User Fee 
# Prepare summary with mean and 95% CI
summary_data <- mlogit_clean %>%
  distinct(RID, .keep_all = TRUE) %>%
  group_by(Zipverified, User.fee_Y.N) %>%
  summarise(
    n = n(),  # count per alternative per Zipverified
    .groups = "drop"
  ) %>%
  group_by(Zipverified) %>%
  mutate(
    total = sum(n),       # total count within each Zipverified group
    prop = n / total      # proportion within Zipverified
    # se = sqrt(prop * (1 - prop) / total),   # standard error
    # ci_lower = (prop - 1.96 * se) * total,  # lower CI (optional)
    # ci_upper = (prop + 1.96 * se) * total   # upper CI (optional)
  )

ggplot(summary_data, aes(x = User.fee_Y.N, y = prop, fill = Zipverified)) +
  geom_col(position = position_dodge(0.9)) +  # side-by-side bars
  # geom_errorbar(
  #   aes(ymin = ci_lower, ymax = ci_upper),
  #   width = 0.2,
  #   position = position_dodge(0.9)
  # ) +
  labs(
    title = "WTP for User Fee: Resident vs Tourist",
    x = "",
    y = "Proportion of responses",
    fill = "Zip Verified"
  ) +
  theme_minimal()
rm(summary_data)

```
```{r}
# Payment Type
# Prepare summary with mean and 95% CI
summary_data <- mlogit_clean %>%
  distinct(RID, .keep_all = TRUE) %>%
  group_by(Zipverified, User.fee_Payment.Type) %>%
  summarise(
    n = n(),  # count per alternative per Zipverified
    .groups = "drop"
  ) %>%
  group_by(Zipverified) %>%
  mutate(
    total = sum(n),       # total count within each Zipverified group
    prop = n / total      # proportion within Zipverified
    # se = sqrt(prop * (1 - prop) / total),   # standard error
    # ci_lower = (prop - 1.96 * se) * total,  # lower CI (optional)
    # ci_upper = (prop + 1.96 * se) * total   # upper CI (optional)
  )

ggplot(summary_data, aes(x = User.fee_Payment.Type, y = prop, fill = Zipverified)) +
  geom_col(position = position_dodge(0.9)) +  # side-by-side bars
  # geom_errorbar(
  #   aes(ymin = ci_lower, ymax = ci_upper),
  #   width = 0.2,
  #   position = position_dodge(0.9)
  # ) +
  labs(
    title = "Payment Type",
    x = "",
    y = "Proportion of responses",
    fill = ""
  ) +
  theme_minimal() + 
  theme(axis.text.x = element_text(angle = 15, hjust = 1))
rm(summary_data)
```

```{r}
# Payment Method 

# Prepare summary with mean and 95% CI
summary_data <- mlogit_clean %>%
  distinct(RID, .keep_all = TRUE) %>%
  group_by(Zipverified, User.fee_Payment.Method) %>%
  summarise(
    n = n(),  # count per alternative per Zipverified
    .groups = "drop"
  ) %>%
  group_by(Zipverified) %>%
  mutate(
    total = sum(n),       # total count within each Zipverified group
    prop = n / total      # proportion within Zipverified
    # se = sqrt(prop * (1 - prop) / total),   # standard error
    # ci_lower = (prop - 1.96 * se) * total,  # lower CI (optional)
    # ci_upper = (prop + 1.96 * se) * total   # upper CI (optional)
  )

ggplot(summary_data, aes(x = User.fee_Payment.Method, y = prop, fill = Zipverified)) +
  geom_col(position = position_dodge(0.9)) +  # side-by-side bars
  # geom_errorbar(
  #   aes(ymin = ci_lower, ymax = ci_upper),
  #   width = 0.2,
  #   position = position_dodge(0.9)
  # ) +
  labs(
    title = "Payment Method",
    x = "",
    y = "Proportion of responses",
    fill = ""
  ) +
  theme_minimal() + 
  theme(axis.text.x = element_text(angle = 15, hjust = 1))
rm(summary_data)
```

```{r}
# Cost Allocation 

# Prepare summary with mean and 95% CI
summary_data <- mlogit_clean %>%
  distinct(RID, .keep_all = TRUE) %>%
  group_by(Zipverified, Cost.Allocation) %>%
  summarise(
    n = n(),  # count per alternative per Zipverified
    .groups = "drop"
  ) %>%
  group_by(Zipverified) %>%
  mutate(
    total = sum(n),       # total count within each Zipverified group
    prop = n / total      # proportion within Zipverified
    # se = sqrt(prop * (1 - prop) / total),   # standard error
    # ci_lower = (prop - 1.96 * se) * total,  # lower CI (optional)
    # ci_upper = (prop + 1.96 * se) * total   # upper CI (optional)
  )

ggplot(summary_data, aes(x = Cost.Allocation, y = prop, fill = Zipverified)) +
  geom_col(position = position_dodge(0.9)) +  # side-by-side bars
  # geom_errorbar(
  #   aes(ymin = ci_lower, ymax = ci_upper),
  #   width = 0.2,
  #   position = position_dodge(0.9)
  # ) +
  labs(
    title = "Cost Allocation",
    x = "",
    y = "Proportion of responses",
    fill = ""
  ) +
  theme_minimal() + 
  theme(axis.text.x = element_text(angle = 15, hjust = 1))
rm(summary_data)
```



```{r}
#Certainty scale 

# Compute group means

mean.CE <- mlogit_clean %>%
distinct(RID, .keep_all = TRUE) %>%
group_by(Zipverified) %>%
summarise(mean_certainty = mean(Certainty.CE_Scale, na.rm = TRUE))

# Visualize Tourist vs Residents

mlogit_clean %>%
distinct(RID, .keep_all = TRUE) %>%
ggplot(aes(x = Certainty.CE_Scale, fill = Zipverified)) +
geom_histogram(binwidth = 1, color = "white", position = "dodge", boundary = 0.5) +
geom_vline(data = mean.CE,
aes(xintercept = mean_certainty, color = Zipverified),
linetype = "dashed", size = 1) +
scale_x_continuous(breaks = 1:10, limits = c(1, 11)) +
labs(
title = "Certainty Rankings by Residency Status",
x = "Certainty Rank (1 = Lowest, 10 = Highest)",
y = "Number of Respondents",
fill = "Respondent Type",
color = "Mean Certainty"
) +
theme_minimal(base_size = 13) +
scale_fill_manual(values = c("Resident" = "#4CAF50", "Tourist" = "#2196F3")) +
scale_color_manual(values = c("Resident" = "#2E7D32", "Tourist" = "#1565C0"))

```
```{r}
summary_data <- mlogit_clean %>%
distinct(RID, .keep_all = TRUE) %>%
filter(!is.na(Mgm.option_No.Text)) %>%
group_by(Zipverified, Mgm.option_No.Text) %>%
summarise(n = n(), .groups = "drop") %>%
group_by(Zipverified) %>%
mutate(total = sum(n), prop = n / total)

ggplot(summary_data, aes(x = Mgm.option_No.Text, y = prop, fill = Zipverified)) +
geom_col(position = position_dodge(0.9)) +
labs(
title = "Management Choice (No Text)",
x = "",
y = "Proportion of Responses",
fill = "Zip Verified"
) +
theme_minimal()
rm(summary_data)
```

```{r}
summary_data <- mlogit_clean %>%
distinct(RID, .keep_all = TRUE) %>%
filter(!is.na(Mgm.option_With.Text)) %>%
group_by(Zipverified, Mgm.option_With.Text) %>%
summarise(n = n(), .groups = "drop") %>%
group_by(Zipverified) %>%
mutate(total = sum(n), prop = n / total)

ggplot(summary_data, aes(x = Mgm.option_With.Text, y = prop, fill = Zipverified)) +
geom_col(position = position_dodge(0.9)) +
labs(
title = "Management Choice (With Text)",
x = "",
y = "Proportion of Responses",
fill = "Zip Verified"
) +
theme_minimal()
rm(summary_data)
```

```{r}
mlogit_clean %>%
distinct(RID, .keep_all = TRUE) %>%
ggplot(aes(x = Zipverified, y = Likelihood_Trail.Use, fill = Zipverified)) +
geom_boxplot() +
labs(
title = "Likelihood of Using Trail if User Fee is Adopted",
x = "Residency Status",
y = "Likelihood Rating (1â€“10)"
) +
theme_minimal()
```

```{r}
# Empirical

mlogit_clean %>%
distinct(RID, .keep_all = TRUE) %>%
ggplot(aes(x = Zipverified, y = Empirical.Expec_Trail.Use, fill = Zipverified)) +
geom_boxplot() +
labs(
title = "Number of People Willing to Use Trails if User Fee is Adopted (out of 10)",
x = "Residency Status", y = ""
) +
theme_minimal()

# Normative

mlogit_clean %>%
distinct(RID, .keep_all = TRUE) %>%
ggplot(aes(x = Zipverified, y = Normative.Expec_Trail.Use, fill = Zipverified)) +
geom_boxplot() +
labs(
title = "Number of People Who Think Others Should Pay User Fee to Use Trails (out of 10)",
x = "Residency Status", y = ""
) +
theme_minimal()

```

```{r}
summary_data <- mlogit_clean %>%
distinct(RID, .keep_all = TRUE) %>%
group_by(Zipverified) %>%
summarise(
mean_rating = mean(Volunteer.WTP, na.rm = TRUE),
sd_rating = sd(Volunteer.WTP, na.rm = TRUE),
n = n(),
se = sd_rating / sqrt(n),
ci_lower = mean_rating - 1.96 * se,
ci_upper = mean_rating + 1.96 * se
)

ggplot(summary_data, aes(x = Zipverified, y = mean_rating, fill = Zipverified)) +
geom_col(width = 0.5) +
geom_errorbar(aes(ymin = ci_lower, ymax = ci_upper), width = 0.2) +
labs(
title = "Average of WTP to Support Volunteers",
x = "Residency Status",
y = "Mean WTP (USD, one-time payment)"
) +
theme_minimal()
rm(summary_data)
```
```{r}
summary_time <- mlogit_clean %>%
summarise(
mean_time = mean(as.numeric(`Duration (in seconds)`), na.rm = TRUE) / 60,
sd_time = sd(as.numeric(`Duration (in seconds)`), na.rm = TRUE) / 60,
min_time = min(as.numeric(`Duration (in seconds)`), na.rm = TRUE) / 60,
max_time = max(as.numeric(`Duration (in seconds)`), na.rm = TRUE) / 60
)

kable(summary_time, caption = "Summary of Survey Duration (in minutes)")
```


```{r}
## Demographic 

# Example: Age distribution

summary_data <- mlogit_clean %>%
distinct(RID, .keep_all = TRUE) %>%
group_by(Zipverified, Demo_Age) %>%
summarise(n = n(), .groups = "drop") %>%
group_by(Zipverified) %>%
mutate(total = sum(n), prop = n / total)

ggplot(summary_data, aes(x = Demo_Age, y = prop, fill = Zipverified)) +
geom_col(position = position_dodge(0.9)) +
labs(
title = "Age Distribution by Residency",
x = "Age Category",
y = "Proportion",
fill = "Residency"
) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
rm(summary_data)
```


```{r}
# Example: Sex distribution

summary_data <- mlogit_clean %>%
distinct(RID, .keep_all = TRUE) %>%
group_by(Zipverified, Demo_Age) %>%
summarise(n = n(), .groups = "drop") %>%
group_by(Zipverified) %>%
mutate(total = sum(n), prop = n / total)

ggplot(summary_data, aes(x = Demo_Age, y = prop, fill = Zipverified)) +
geom_col(position = position_dodge(0.9)) +
labs(
title = "Sex Distribution by Residency",
x = "Age Category",
y = "Proportion",
fill = "Residency"
) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
rm(summary_data)

```




